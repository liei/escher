#include <stdlib.h>
#include <stdio.h>

#include <gsl/gsl_rng.h>
#include <gsl/gsl_randist.h>

#include <simulation.h>
#include <statistics.h>

void bootstrap(gsl_rng *gen,simulation_t *sim,int *r_x,int *r_y){
  double theta_x,theta_y,u;
  int x = 0, y = 0;

  //Initializing arrays, number of succesess and probability for success		
  theta_x = sim->result_x / (double)sim->size_x; 
  theta_y = sim->result_y / (double)sim->size_y; 
   
  for(int i = 0; i < sim->size_x; i++) {
    u = gsl_ran_flat(gen, 0, 1);
    if(u < theta_x)
      x++;
  }
  
  for(int i = 0; i < sim->size_y; i++){
    u = gsl_ran_flat(gen, 0,1);
    if(u < theta_y)
      y++;
  }	
  *r_x = x;
  *r_y = y;
}

double gibbs_sampler(gsl_rng *gen,simulation_t *sim,int *history_z,int i, int x, int y){
	
  double alpha = sim->mc_steps + sim->size_y + x - y + history_z[i-1] + 1;  	
  double beta  = sim->n_samples - history_z[i-1] + sim->size_x - x - sim->size_y + y - sim->mc_steps + 1;

  for(int i = 0; i < sim->mc_steps; i++){
      alpha += sim->tp_alpha[i];
      beta  += sim->tp_beta[i];
  }

  double theta = gsl_ran_beta(gen,alpha,beta);
  history_z[i] = gsl_ran_binomial(gen, theta, sim->n_samples);
	
  return theta;
}
